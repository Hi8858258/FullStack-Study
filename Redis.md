# Redis

## 一.互联网架构演变

### 1.1 单机Mysql时代

90年代访问量小，单个数据库完全足够，而且更多的是去使用静态网页，数据库服务器没什么压力。

发展阶段：优化数据结构和索引->文件缓存（IO）->Memcached

### 1.2 Memcached（缓存）+ 垂直拆分（读写分离）

当出现1.数据量增加，一个机器放不下了。2.数据的索引（B+Tree）,一个机器内存放不下了。3.访问量（读写混合）,一个服务器承受不了。就需要使用到缓存了。

这个时候就会使用垂直拆分，多台服务器（每台服务器中的数据是相同的），将读和写分离，并且将常用数据放到缓存中，解决了读的速度

![image-20200821062055083](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200821062055083.png)

### 1.3 分库分表+水平拆分（Mysql集群）

当数据量非常大，不能够支持所有数据库都同步的时候就会开始集群。图中的M代表master主节点，s代表slave，从节点

![image-20200821062731656](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200821062731656.png)



### 1.4 如今的年代

技术爆炸：出现了很多类型的数据，mysql等关系型数据库已经不够使用了，就出现了很多其他类型的数据库 , 需要用到NoSQL

1. 商品的基本信息

   名称、价格、商家信息使用的是关系型数据库

2. 商品的描述，评论（文字比较多）

   文档型数据库，MangoDB

3. 图片

   分布式文件系统FastDFS

   淘宝自己的TFS

   GOOGLE的GFS

   Hadoop 的HDFS

   阿里云的OSS

4. 商品的关键字（搜索）

   搜索引擎 solr elasticsearch

   淘宝用的是ISerach:多隆写的

5. 商品热门的波段信息

   内存数据库

   Redis、Memache

6. 商品的交易，外部的支付接口

   三方应用  

## 二. 什么是NoSQL（不仅仅是SQL）

数据类型的存储不需要一个固定的格式，而且可以横向扩展

#### 2.1 NoSQL特点

- 方便扩展（数据直接没有关系，每条数据好比是一个对象，可以不断给这个对象添加属性）
- 大数据量高性能（Redis一秒写8万次，读11万，NoSQL是一种细粒度的缓存）
- 数据类型多样（不需要事先涉及数据库）
- 传统的RDBMS和NoSQL
  - 传统的RDBMS
    - 结构化阻止
    - SQL语言
    - 数据和关系都存在单独的表中
    - 操作，数据定义语言
    - 一致性
    - 基础的实务操作
  - NoSQL
    - 不仅仅是sql
    - 没有固定的sql语言
    - 键值对存储，列存储，文档存储，图形数据库
    - 最终一致性
    - CAP定理和BASE （异地多活！）初级架构师
    - 高性能，高可用，高扩展性

### 2.2 NoSQL 四大分类

- KV键值对：
  - 新浪：redis
  - 美团：Redis+Tair
  - 阿里百度：Redis+memcache
- 文档型数据库（bson格式和json一样）
  - MongoDB(必须要掌握)
    - MongoDB是基于分布式文件存储的数据库，C++编写，主要用来处理大量的文档
    - 介于关系型数据库和非关系型数据库中间的产品！MongoDB是非关系型数据库中功能最丰富，最像关系型数据库的
  - ConthDB
- 列存储数据库
  - HBase
  - 分布式文件系统
- 图关系数据库

## 三.Redis概述

Redis(Remote Dictionary Server) 远程字典服务，是一个开源的使用ANSC C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。免费和开源，是当前最热门的NoSQL技术之一 

- 简介：redis是一种nosql数据库，他们的数据是保存在内存中的，同时redis可以定时把内存数据同步到磁盘（这个是和memcache不一样的地方），并且它比memcached支持更多的数据结构（string,list,set,sorted set, hash）

- 使用场景：

  - 登入会话存储，redis和memchached相比数据不会丢失
  - 排行榜/计数器：比如一些秀场类的项目，经常会使用一些前多少名的主播排名。还有一些文章阅读量的技术，或者新浪微博
  - 作为消息队列：比如celery就是使用redis作为中间人
  - 当前在线人数：
  - 常用的数据缓存：比如bbs论坛，板块不会经常变化，但是如果数据每次都从sql中去就会比较负担，可以在redis中存起来
  - 把前200篇文章缓存或者评论缓存：一般用户浏览网站，只会浏览前面一部分文章或者评论，可以把前面200篇文章和对应的评论缓存起来
  - 好友关系：微博的好友关系使用redis实现
  - 发布和订阅功能：可以用来做聊天软件

- redis和memcached的比较：

  |              | memcached                     | redis                          |
  | ------------ | ----------------------------- | ------------------------------ |
  | 类型         | 内存                          | 内存磁盘同步数据库             |
  | 数据类型     | 在定义value时就要固定数据类型 | 不需要                         |
  | 虚拟内存     | 不支持                        | 支持                           |
  | 过期策略     | 支持                          | 支持                           |
  | 存储数据安全 | 不支持                        | 可以将数据同步到dump.db中      |
  | 灾难恢复     | 不支持                        | 可以将磁盘中的数据恢复到内存中 |
  | 分布式       | 支持                          | 主从同步                       |
  | 订阅与发布   | 不支持                        | 支持                           |

  

#### 3.1 Redis

1. 下载redis的安装包 使用 wget http:……
2. 解压安装包 tar -zwvf redis.tar.gz
3. 进入文件包，可以看到redis.conf配置文件
4. 基本的环境安装 yum install gcc -y
5. 使用make 配置安装